#!/usr/bin/env bash

REACHABLE_HOST="$1"
shift
cmd=$*

TRIES=0
while true; do
    let TRIES++
    if ((TRIES>120)); then
        echo "Maximum tries reached, aborting."
        notify-send "\"$REACHABLE_HOST\" not reachable." "Command: $cmd" --icon=dialog-error
        exit 1
    fi

    echo "Waiting for host at \"$REACHABLE_HOST\". Attempt Number "$TRIES"."

    ping -W 1 -c 1 $REACHABLE_HOST &> /dev/null
    if [ $? -eq 0 ]; then
        echo "Host now reachable, executing \"$cmd\""
        $cmd
        exit
    else
        echo "\"$REACHABLE_HOST\" not reachable."
    fi

    sleep 1
done


